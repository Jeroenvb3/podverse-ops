version: "2"

services:

  podverse_db:
    image: postgres
    container_name: podverse_db_local
    env_file:
      - ./config/podverse-db-local.env
    ports:
      - '5432:5432'
    command: postgres -c superuser_reserved_connections=100
    restart: always

  podverse_api:
    image: podverse_api
    container_name: podverse_api_local
    depends_on:
      - podverse_db
    env_file:
      - ./config/podverse-api-local.env
    ports:
      - '1234:1234'
    volumes:
      - ./config/bitpay/api.key:/tmp/src/config/bitpay/api.key
      - ./config/google/jwt.keys.json:/tmp/src/config/google/jwt.keys.json
    command: npm start

  podverse_api_parser_worker:
    image: podverse_api
    container_name: podverse_api_parser_worker_local
    env_file:
      - ./config/podverse-api-local.env

  podverse_api_stats:
    image: podverse_api
    container_name: podverse_api_stats_local
    env_file:
      - ./config/podverse-api-local.env
    volumes:
      - ./config/google/jwt.keys.json:/tmp/src/config/google/jwt.keys.json

  podverse_web:
    image: podverse_web
    container_name: podverse_web_local
    depends_on:
      - podverse_db
      - podverse_api
    env_file:
      - ./config/podverse-web-local.env
    ports:
      - '8765:8765'
    command: npm start

  podverse_admin:
    image: podverse_admin
    container_name: podverse_admin_local
    depends_on:
      - podverse_db
    env_file:
      - ./config/podverse-admin-local.env
    ports:
      - '8000:8000'
    command: python manage.py runserver 0.0.0.0:8000


networks:
  default:
    driver: bridge